CREATE TABLE admin (
    id_admin         NUMBER NOT NULL,
    num_tef          NUMBER NOT NULL,
    usuario_id_user  NUMBER NOT NULL,
    nombre           VARCHAR2(25) NOT NULL,
    apellido         VARCHAR2(25) NOT NULL
);

CREATE UNIQUE INDEX admin_user_idx ON admin (usuario_id_user ASC);

ALTER TABLE admin ADD CONSTRAINT admin_pk PRIMARY KEY (id_admin);

CREATE TABLE estadisticas (
    id_ent                NUMBER NOT NULL,
    date_recorded         DATE NOT NULL,
    sesiones_completadas  NUMBER NOT NULL,
    total_sesiones        NUMBER NOT NULL,
    porcentaje_de_mejora  FLOAT NOT NULL,
    tiem_total_ent        NUMBER NOT NULL,
    heart_rate            NUMBER NOT NULL,
    rutina_id_rutina      NUMBER NOT NULL,
    persona_rut           VARCHAR2(12) NOT NULL,
    imc                   FLOAT NOT NULL,
    resumen_id_resumen    NUMBER NOT NULL
);

ALTER TABLE estadisticas ADD CONSTRAINT estadisticas_pk PRIMARY KEY (id_ent);

CREATE TABLE persona (
    rut              VARCHAR2(12) NOT NULL,
    nombre_pri       VARCHAR2(15) NOT NULL,
    nombre_sec       VARCHAR2(15),
    apellido_pat     VARCHAR2(15) NOT NULL,
    apellido_mat     VARCHAR2(15) NOT NULL,
    peso             FLOAT NOT NULL,
    estatura         FLOAT NOT NULL,
    act_ficica       NUMBER NOT NULL,
    discapacidad     NUMBER NOT NULL,
    objetivo         VARCHAR2(100) NOT NULL,
    edad             NUMBER NOT NULL,
    fecha_nac        DATE NOT NULL,
    num_tef_p        NUMBER NOT NULL,
    usuario_id_user  NUMBER NOT NULL
);

CREATE UNIQUE INDEX persona_user_idx ON persona (usuario_id_user ASC);

ALTER TABLE persona ADD CONSTRAINT persona_pk PRIMARY KEY (rut);

CREATE TABLE resumen (
    id_resumen            NUMBER NOT NULL,
    total_sesiones        NUMBER NOT NULL,
    sesiones_completadas  NUMBER NOT NULL,
    promedio_tiem         NUMBER NOT NULL,
    imc_inicial           FLOAT NOT NULL,
    imc_actual            FLOAT NOT NULL,
    peso_inicial          FLOAT NOT NULL,
    peso_actual           FLOAT NOT NULL
);

ALTER TABLE resumen ADD CONSTRAINT resumen_pk PRIMARY KEY (id_resumen);

CREATE TABLE rutina (
    id_rutina       NUMBER NOT NULL,
    tipo_rut        VARCHAR2(25) NOT NULL,
    total_sesiones  NUMBER NOT NULL,
    nombre          VARCHAR2(20) NOT NULL,
    persona_rut     VARCHAR2(12) NOT NULL
);

ALTER TABLE rutina ADD CONSTRAINT rutina_pk PRIMARY KEY (id_rutina);

CREATE TABLE soporte (
    id_soporte      NUMBER NOT NULL,
    modificacion    VARCHAR2(100) NOT NULL,
    razon           VARCHAR2(100) NOT NULL,
    fecha           DATE NOT NULL,
    admin_id_admin  NUMBER NOT NULL
);

ALTER TABLE soporte ADD CONSTRAINT soporte_pk PRIMARY KEY (id_soporte);

CREATE TABLE usuario (
    id_user         NUMBER NOT NULL,
    nombre          VARCHAR2(20) NOT NULL,
    contrasena      VARCHAR2(20) NOT NULL,
    admin_id_admin  NUMBER NOT NULL,
    tipo            NUMBER NOT NULL,
    persona_rut     VARCHAR2(12) NOT NULL,
    fecha_ini       DATE NOT NULL,
    email           VARCHAR2(100) NOT NULL
);

CREATE UNIQUE INDEX usuario_admin_idx ON usuario (admin_id_admin ASC);
CREATE UNIQUE INDEX usuario_persona_idx ON usuario (persona_rut ASC);

ALTER TABLE usuario ADD CONSTRAINT usuario_pk PRIMARY KEY (id_user);

-- Relaciones
ALTER TABLE admin
    ADD CONSTRAINT admin_usuario_fk FOREIGN KEY (usuario_id_user)
        REFERENCES usuario (id_user);

ALTER TABLE estadisticas
    ADD CONSTRAINT estadisticas_persona_fk FOREIGN KEY (persona_rut)
        REFERENCES persona (rut);

ALTER TABLE estadisticas
    ADD CONSTRAINT estadisticas_resumen_fk FOREIGN KEY (resumen_id_resumen)
        REFERENCES resumen (id_resumen);

ALTER TABLE estadisticas
    ADD CONSTRAINT estadisticas_rutina_fk FOREIGN KEY (rutina_id_rutina)
        REFERENCES rutina (id_rutina);

ALTER TABLE persona
    ADD CONSTRAINT persona_usuario_fk FOREIGN KEY (usuario_id_user)
        REFERENCES usuario (id_user);

ALTER TABLE rutina
    ADD CONSTRAINT rutina_persona_fk FOREIGN KEY (persona_rut)
        REFERENCES persona (rut);

ALTER TABLE soporte
    ADD CONSTRAINT soporte_admin_fk FOREIGN KEY (admin_id_admin)
        REFERENCES admin (id_admin);

ALTER TABLE usuario
    ADD CONSTRAINT usuario_admin_fk FOREIGN KEY (admin_id_admin)
        REFERENCES admin (id_admin);

ALTER TABLE usuario
    ADD CONSTRAINT usuario_persona_fk FOREIGN KEY (persona_rut)
        REFERENCES persona (rut);
